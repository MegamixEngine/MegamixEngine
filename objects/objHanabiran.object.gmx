<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>sprHanabiran</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>-2</depth>
  <persistent>0</persistent>
  <parentName>prtMiniBoss</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Hirabiran should be placed along with [objHanabiranSpawnLocation](objHanabiranSpawnLocation.html). These will determine the locations to where he can spawn to during the fight and allow for custom rooms. You do not need to place a spawner underneath Hanabiran, he'll create one
// there himself.


event_inherited();
respawn = true;
doesIntro = false;
healthpointsStart = 16;
healthpoints = healthpointsStart;
contactDamage = 6;
blockCollision = 0;
grav = 0;
facePlayerOnSpawn = false;
category = "nature";

despawnRange = -1;
rescursiveExplosion = false; //true;
deadTimerMax = 48;
deadTimerRecur = 4;
//explosionSprite = sprExplosion;
explosionSFX = sfxMM9ExplosionAlt;
finalExplosionSprite = sprBigExplosion;
// Enemy specific code
image_speed = 0;
image_index = 1;
phase = -1;
attackTimer = 0;
attackTimerMax = 8;
shotsFired = -1;
animTimer = 1;

headX[0] = 0;
headX[1] = 2;
headX[2] = -2;
headX[4] = 0;

oldLocation = noone;
cLocation = noone;

cAngle = 0;
cDistance = 8;
addAngle = 8;

flowerSet = 0;
currentChild = objHanabiranFlower;

// creation code variables

//@cc if this is set to false, then the clock arm in his room won't be destroyed when he dies.
destroyClockArm = true;

//@cc set object and sprite of the flower. add elements to the array to alternate 'flower objects' every time hanabiran changes places
childObject[0] = objHanabiranFlower;
childSprite[0] = sprHanabiranFlower;
//how long hanabiran takes to start firing flowers and change places
flowerPhaseMax = 32;
changePhaseMax = 48;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>event_inherited();
if (entityCanStep())
{
    if (destroyClockArm)
    {
        with (objHanabiranClockArm)
        {
            if (destroyTimer &gt; 0)
            {
                destroyTimer *= -1;
            }
            triggerDestroy = 3;
        }
    }
    
    attackTimer += 1;
    
    if (!place_meeting(x, y, objHanabiranSpawnLocation) &amp;&amp; phase == -1)
    {
        var inst = instance_create(x, y, objHanabiranSpawnLocation);
        oldLocation = inst;
        phase = 1;
    }
    switch (phase)
    {
        case 0: // find location 
            var inst = oldLocation;
            cLocation = oldLocation;
            
            // hanabiran cannot put itself where it used to be, or where mega man is
            for (var i = 0; i &lt; 256; i++) // this will eventually give up if it can't find a situable place - basically idiot proofing
            {
                if (cLocation == oldLocation || place_meeting(inst.x, inst.y, objMegaman) || place_meeting(inst.x, inst.y, objHanabiran))
                {
                    inst = instance_find(objHanabiranSpawnLocation, irandom(instance_number(objHanabiranSpawnLocation) - 1));
                    cLocation = inst;
                }
            }
            if (attackTimer &gt;= 96)
            {
                canHit = true;
                x = inst.x;
                y = inst.y;
                shotsFired = -1;
                attackTimer = 0;
                phase = 1;
                oldLocation = cLocation;
            }
            break;
        case 1: // attack 
            if (animTimer &lt; 8)
            {
                contactDamage = 4;
                if (animTimer &lt; 5)
                {
                    animTimer += 0.25;
                }
                else
                {
                    animTimer += 0.125;
                }
                image_index = min(animTimer, 7);
                if (shotsFired == -1 &amp;&amp; image_index &gt;= 5) // create flower petals
                {
                    for (var i = 0; i &lt; 4; i++)
                    {
                        var inst = instance_create((x + headX[0]) + cos((i * degtorad(90)) * cDistance), (y) + sin((i * degtorad(90)) * cDistance), childObject[flowerSet]);
                        inst.image_index = 2 * i;
                        inst.cAngle = 90 * i;
                        inst.parent = id;
                        inst.flowerNumber = i;
                        inst.sprite_index = childSprite[flowerSet];
                    }
                    shotsFired = 0;
                }
            }
            else
            {
                animTimer = 5;
            }
            if (attackTimer == flowerPhaseMax &amp;&amp; shotsFired &lt; 4) // fire off flower petals towards mega man. this is handled in that object's step code.
            {
                with (currentChild)
                {
                    if (flowerNumber == other.shotsFired &amp;&amp; parent == other.id)
                    {
                        hasFired = true;
                    }
                }
                shotsFired++;
                attackTimer = 0;
            }
            else if (attackTimer == changePhaseMax) // change phase
            {
                phase = 2;
                attackTimer = 0;
                animTimer = 8;
            }
            break;
        case 2: // vanish 
            with (currentChild) // destroy existing attached flower petals
            {
                if (!hasFired &amp;&amp; parent == other.id)
                {
                    instance_destroy();
                }
            }
            if (animTimer &lt; 10)
            {
                image_index = min(animTimer, 9);
                animTimer += 0.25;
            }
            else // reset variables for changing places.
            {
                attackTimer = 0;
                oldLocation = instance_place(x, y, objHanabiranSpawnLocation);
                flowerSet ++;
                if (flowerSet &gt;= array_length_1d(childObject))
                    flowerSet = 0;
                currentChild = childObject[flowerSet];
                canHit = false;
                contactDamage = 0;
                phase = 0;
                animTimer = 1;
                image_index = 1;
            }
            break;
    }
}
else if (!insideView())
{
    image_index = 1;
    y = ystart;
    x = xstart;
    attackTimer = 0;
    phase = -1;
    shotsFired = -1;
    currentChild = childObject[0];
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="21">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// if shot, stop firing.
shotsFired = 4;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="20">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>    
event_inherited();
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="4">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>currentChild = childObject[0];
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if (ceil(image_index) != 1)
    event_inherited();
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
