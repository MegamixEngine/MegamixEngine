<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>sprKakinbatank</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>prtEntity</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Create Event
event_inherited();
contactDamage = 5;
healthpointsStart = 10;
healthpoints = 10;
facePlayerOnSpawn = false;
category = "grounded, bulky, shielded";

// @cc - Change colour: 0 (default) = red, 1 = green
col = 0;

// Enemy specific code
// Constants
speed1 = 0.75;
speed2 = 0.45;
maxDist = 16 * 3;

// Variables
phase = 0;
timer = 60;
shielded = true;
detectsShot = false;
mask_index = sprKakinbatank;
animFrame = 0;
prevX = x;
xscaleStart = image_xscale;
init = 1;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>event_inherited();

//Change colours
if (init)
{
    switch(col)
    {
        case 1:
            sprite_index = sprKakinbatankGreen;
            break;
        default:
            sprite_index = sprKakinbatank;
            break;
    }
    init = 0;
}

if (entityCanStep())
{
    if (shielded)
    {
        switch (phase)
        {
            case 0: // Sleep 
                if (timer &lt; 60)
                {
                    timer += 1;
                    xspeed = 0;
                }
                else
                {
                    if (detectsShot)
                    {
                        detectsShot = false;
                        prevX = x;
                        phase = 1;
                        timer = 0;
                    }
                    else
                    {
                        animFrame += 0.015;
                        if (floor(animFrame) &gt; 1)
                            animFrame = 0;
                    }
                }
                break;
            case 1: // Move forward 
                if (timer == 0)
                {
                    animFrame = 2;
                    xspeed = 0;
                }
                if (timer &gt; 45)
                {
                    xspeed = speed1 * image_xscale;
                    if ((instance_exists(target) &amp;&amp; target.bbox_left &lt; bbox_right + 16 &amp;&amp; target.bbox_right &gt; bbox_left - 16) || (instance_exists(target) &amp;&amp; sign(x - target.x) == image_xscale))
                    {
                        phase = 3;
                        timer = 0;
                    }
                    var onLimit = sign(x - (prevX + maxDist * image_xscale)) == image_xscale;
                    if (checkFall(32*sign(image_xscale)) || onLimit)
                    {
                        if (onLimit)
                        {
                            x = prevX + maxDist * image_xscale;
                        }
                        xspeed = 0;
                        if (phase == 1)
                            phase = 2;
                        timer = 0;
                    }
                    animFrame += 0.2;
                    if (floor(animFrame) &gt; 3)
                        animFrame = 2;
                }
                else
                    timer += 1;
                break;
            case 2: // Retreat 
                if (timer &gt; 60)
                {
                    xspeed = -speed2 * image_xscale;
                    animFrame += 0.1;
                    if (floor(animFrame) &gt; 3)
                        animFrame = 2;
                    if (sign(x - xstart) != image_xscale || xcoll != 0)
                    {
                        x = xstart;
                        phase = 0;
                        timer = 0;
                        xspeed = 0;
                    }
                    if (detectsShot)
                    {
                        detectsShot = false;
                        prevX = x;
                        phase = 1;
                        timer = 0;
                    }
                }
                else
                    timer += 1;
                break;
            case 3: // Drop shield 
                if (timer == 0)
                    animFrame = 4;
                xspeed = 0;
                if (timer &lt; 30)
                {
                    timer += 1;
                    
                    // Vibreate;
                    animFrame += 0.2;
                    if (floor(animFrame) &gt; 5)
                        animFrame = 4;
                }
                else
                {
                    animFrame += 0.3;
                    if (floor(animFrame) &gt; 10)
                    {
                        animFrame = 12;
                        shielded = false;
                        phase = 0;
                        timer = 0;
                        mask_index = mskKakinbatank;
                    }
                    
                    
                    if (animFrame &gt; 7)
                    {
                        if (instance_exists(objMegaman))
                        {
                            var collided = collision_rectangle(x, y, x + 48 * image_xscale, y - 30, objMegaman, false, true);
                            if (collided != noone)
                            {
                                with (collided)
                                {
                                    if (canHit &amp;&amp; iFrames == 0)
                                    {
                                        with (other)
                                            entityEntityCollision();
                                    }
                                }
                            }
                        }
                    }
                }
                break;
        }
    }
    else
    {
        switch (phase)
        {
            case 0:
                if (instance_exists(target) &amp;&amp; sign(x - target.x) == image_xscale)
                {
                    phase = 1;
                    timer = 0;
                }
                else
                {
                    timer += 1;
                    if (timer &lt; 30)
                        animFrame = 12;
                    else
                    {
                        if (timer == 30)
                        {
                            animFrame = 13;
                            var i = instance_create(x, y, objEnemyBullet);
                            i.contactDamage = 3;
                            i.sprite_index = sprKakinbatankBullet;
                            i.image_xscale = image_xscale;
                            i.image_yscale = image_yscale;
                            i.image_speed = 0;
                            if (col == 1)
                            {
                                i.image_index = 1; // Green bullets
                            }
                            else
                            {
                                i.image_index = 0; // Red bullets
                            }
                            i.x = x + 4 * image_xscale;
                            i.y = y - 36 * image_yscale;
                            i.target = target;
                            i.yspeed = -4;
                            i.blockCollision = false;
                            i.grav = 0.35;
                            if (instance_exists(target))
                            {
                                with (i)
                                {
                                    xspeed = xSpeedAim(x, y, target.x, target.y, yspeed, grav, 4);
                                }
                            }
                        }
                        
                        if (timer &gt; 47)
                            animFrame = 12;
                        if (timer &gt; 60)
                            timer = 0;
                    }
                }
                break;
            case 1:
                if (timer == 0)
                {
                    timer = 1;
                    animFrame = 11;
                }
                else
                {
                    animFrame += 0.1;
                    if (floor(animFrame) &gt; 11)
                    {
                        phase = 0;
                        image_xscale *= -1;
                        timer = 0;
                    }
                }
                break;
        }
    }
    if (detectsShot)
        detectsShot = false;
    image_index = floor(animFrame);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="25">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// spawn Event
event_inherited();
mask_index = sprKakinbatank;
phase = 0;
timer = 60;
attackTimer = 0;
shielded = true;
detectsShot = false;
animFrame = 0;
y -= 1;
image_xscale = xscaleStart;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="21">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Reflect shots
detectsShot = true;
if (mask_index == mskKakinbatank || (sign(x - other.x) == image_xscale))
    exit;

if (collision_rectangle(x + 12 * image_xscale, y, x + 28 * image_xscale, y - 47 * image_yscale, other, false, true))
{
    other.guardCancel = 1;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="20">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Death Event
event_inherited();
instance_create(bbox_left + abs(bbox_left - bbox_right) / 2, bbox_top + abs(bbox_top - bbox_bottom) / 2, objBigExplosion);
stopSFX(getGenericSFX(SFX_ENEMYHIT));
playSFX(getGenericSFX(SFX_EXPLOSIONMM9Alt));
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
