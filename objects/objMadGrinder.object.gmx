<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>sprMadGrinder</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>prtMiniBoss</parentName>
  <maskName>mskMadGrinder</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// image_xscale = 1 or -1 //(Use editor for this!!) // determines the direction Mad Grinder is locked in.
event_inherited();
respawn = true;
introSprite = sprMadGrinderTeleport;
healthpointsStart = 18;
healthpoints = healthpointsStart;
contactDamage = 4;
blockCollision = 1;
grav = 0.15 * image_yscale;
faction = 5;
penetrate = 3;

// Enemy specific code
image_speed = 0;
image_index = 1;
doQuake = 0;
phase = 0;
jitterFrame = 0;
mouthOpen = false;
wheelFrame = 0;
rollerFrame = 0;
cutterFrame = 0;
hasCutter = true;
child = noone;

shotsFired = 0;

attackTimer = 0;
attackTimerMax = 24;

moveDir = image_xscale;

//@cc if set to 1, mad grinder does not use his fireball attack that was exclusive to power fighters and the intro to MM7.
variant = 0;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>event_inherited();
if (entityCanStep()
    &amp;&amp; introTimer &lt;= 0)
{
    if (doQuake &gt; 0) // quake effect
    {
        screenShake(2, 2, 2);
        if (doQuake == 48)
        {
            playSFX(sfxGutsQuake);
        }
        doQuake--;
        with (objMegaman)
        {
            if (ground) // shunt mega man off the floor to prevent sliding and break dash
            {
                y -= 1.5 * (irandom(3) + 1);
            }
        }
    }
    
    
    // animation setup
    if (xspeed != 0)
    {
        jitterFrame += 0.25 * sign(xspeed);
        if (jitterFrame &gt;= 2)
            jitterFrame -= 2;
        else if (jitterFrame &lt; 0)
            jitterFrame += 2;
        wheelFrame += 0.125 * sign(xspeed);
        if (wheelFrame &gt;= 3)
            wheelFrame -= 3;
        else if (wheelFrame &lt; 0)
            wheelFrame += 3;
        rollerFrame += 0.25 * sign(xspeed);
        if (rollerFrame &gt;= 8)
            rollerFrame -= 8;
        else if (rollerFrame &lt; 0)
            rollerFrame += 8;
    }
    
    switch (phase)
    {
        case 0:
        case 2:
        case 6:
        case 8: // move
        // turn around 
            xspeed = 0.75 * moveDir;
            if (xcoll != 0 || !positionCollision(x + 8 * moveDir, y + 33) || positionCollision(x + 128 * moveDir, y) &amp;&amp; moveDir == image_xscale)
            {
                xspeed = 0;
                moveDir *= -1;
                phase++;
            }
            break;
        case 1:
        case 5:
        case 11: // fire cutter 
            if (cutterFrame &lt; 6)
            {
                cutterFrame += 0.25;
            }
            if (cutterFrame == 6 &amp;&amp; attackTimer == 0)
            {
                var inst = instance_create(x + 24 * image_xscale, y - 24, objMadGrinderBlade);
                inst.image_xscale = image_xscale;
                inst.parent = id;
                child = inst.id;
                playSFX(sfxWheelCutter1);
                attackTimer = 1;
                hasCutter = false;
            }
            if (!instance_exists(child) &amp;&amp; attackTimer == 1)
            {
                hasCutter = true;
                cutterFrame = 0;
                phase++;
                attackTimer = 0;
                playSFX(sfxCrashBombArm);
            }
            break;
        case 3:
        case 9: // jump 
            yspeed = -4;
            playSFX(sfxCyberGabyoallBoost);
            phase++;
            break;
        case 4:
        case 10: // land 
            attackTimer++;
            if (ground)
            {
                attackTimer = 0;
                doQuake = 48;
                phase++;
            }
            break;
        case 7: // fire fireballs if variant 0; 
            if (variant != 0)
            {
                phase = 1;
            }
            else
            {
                jitterFrame = 2;
                mouthOpen = true;
                attackTimer++;
                
                if (attackTimer == attackTimerMax &amp;&amp; shotsFired &lt; 4)
                {
                    var fire = instance_create(x + 16 * image_xscale, y - 16, objMadGrinderFire);
                    with (fire)
                    {
                        instance_create(x, y, objExplosion);
                    }
                    playSFX(sfxEnemyShootClassic);
                    switch (shotsFired)
                    {
                        case 0:
                            fire.image_xscale = image_xscale;
                            fire.xspeed = 2 * image_xscale;
                            fire.yspeed = -1;
                            break;
                        case 1:
                            fire.image_xscale = image_xscale;
                            fire.xspeed = 3 * image_xscale;
                            fire.yspeed = 0;
                            break;
                        case 2:
                            fire.image_xscale = image_xscale;
                            fire.xspeed = 2 * image_xscale;
                            fire.yspeed = 1;
                            break;
                        case 3:
                            fire.image_xscale = image_xscale;
                            fire.xspeed = 1.5 * image_xscale;
                            fire.yspeed = 1.5;
                            break;
                    }
                    shotsFired++;
                    attackTimer = 0;
                }
                
                if (shotsFired == 4)
                {
                    mouthOpen = false;
                }
                if (attackTimer == attackTimerMax * 2)
                {
                    attackTimer = 0;
                    shotsFired = 0;
                    phase++;
                }
            }
            break;
        case 12: // reset pattern 
            phase = 0;
            break;
    
    
    
    }
}
else if (!insideView())
{
    image_index = 0;
    y = ystart;
    x = xstart;
    attackTimer = 0;
    jitterFrame = 0;
    wheelFrame = 0;
    rollerFrame = 0;
    phase = 0;
    doQuake = 0;
    turnTrigger = false;
    findYSpeed = false;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="21">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if (other.y &gt; y - 8)
{
    other.guardCancel = 1;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="20">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>facePlayerOnSpawn = false;
with (objMadGrinderBlade)
{
    if (parent == other.id)
    {
        instance_destroy();
    }
}
event_inherited();
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="12">
      <action>
        <libid>1</libid>
        <id>605</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>0</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>drawing mad grinder</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>draw_sprite_ext(sprite_index, 1 + clamp(jitterFrame, 0, 2 + mouthOpen), round(x), round(y), image_xscale, image_yscale, image_angle, image_blend, image_alpha);
draw_sprite_ext(sprite_index, 8 + clamp(rollerFrame, 0, 8), round(x), round(y) - (image_index - 2), image_xscale, image_yscale, image_angle, image_blend, image_alpha);
draw_sprite_ext(sprite_index, 5 + clamp(wheelFrame, 0, 3), round(x), round(y) - (image_index - 2), image_xscale, image_yscale, image_angle, image_blend, image_alpha);
draw_sprite_ext(sprite_index, 4, round(x), round(y) - round(clamp(jitterFrame, 0, 2)), image_xscale, image_yscale, image_angle, image_blend, image_alpha);
if (hasCutter)
    draw_sprite_ext(sprite_index, 16 + cutterFrame mod 6, round(x), round(y) - (image_index - 2), image_xscale, image_yscale, image_angle, image_blend, image_alpha);
if (yspeed &lt; 0)
{
    draw_sprite(sprMadGrinderJet, (attackTimer / 2) mod 2, round(x), round(y) + 32);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// handles stuff differently than the Puny Regular Enemies....
if (introTimer &gt; 0 &amp;&amp; doesIntro)
{
    draw_sprite_ext(introSprite, 2 - (min(2, min(introTimer, 15) / 5)), x,
        y - max(introTimer - 10, 0) * image_yscale, image_xscale, image_yscale, 0, c_white, 1);
}
else
{
    // this debug message should be left in until
    // the spawn system stops breaking every week.
    
    if (spawned == -1)
    {
        show_debug_message(object_get_name(object_index) + " drawn without having ever spawned!");
    }
    if ((ceil(iFrames / 2) mod 4) || !iFrames)
    {
        if ((ceil(iFrames / 2) mod 2) || (iceTimer &gt; 0))
        {
            var flashcol = c_white;
            if (iceTimer &gt; 0)
            {
                flashcol = make_color_rgb(0, 120, 255);
            }
            
            d3d_set_fog(true, flashcol, 0, 0);
            event_user(2);
            d3d_set_fog(false, 0, 0, 0);
            
            if (iceTimer &gt; 0)
            {
                draw_set_blend_mode(bm_add);
                event_user(2);
                draw_set_blend_mode(bm_normal);
            }
        }
        else
        {
            event_user(2);
        }
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
