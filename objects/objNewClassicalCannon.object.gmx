<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>sprNewClassicalCannon</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>prtEntity</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>event_inherited();
grav = 0.25 * image_yscale;
facePlayerOnSpawn = false;
healthpointsStart = 6;
contactDamage = 4;
category = "cannons";

// Enemy specific code
// @cc - Change colours - 0 (default) = green, 1 = blue, 2 = yellow, 3 = red
col = 0;

angle = 0 + 8 * (image_xscale == -1);
newAngle = angle;
timer = 0;
phase = 0;
despawnRange = 4;
respawnRange = 1;
tx = -1;
ty = -1;
aimDist = 0;
xscaleStart = image_xscale;
animOffset = 0;
gravDir = 0;

old = false;
init = 1;

// Sprites
greenSprite = sprNewClassicalCannon;
blueSprite = sprNewClassicalCannonBlue;
yellowSprite = sprNewClassicalCannonYellow;
redSprite = sprNewClassicalCannonRed;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="1">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Change colours based on sprite
event_inherited();
if (init)
{
    switch (col)
    {
        case 1:
            sprite_index = blueSprite;
            break;
        case 2:
            sprite_index = yellowSprite;
            break;
        case 3:
            sprite_index = redSprite;
            break;
        default:
            sprite_index = greenSprite;
            break;
    }
    init = 0;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>event_inherited();

if (entityCanStep())
{
    if (gravDir == 0)
        gravDir = 1;
    if (instance_exists(target))
    {
        gravDir = target.image_yscale;
    }
    if (phase == 0) // aim
    {
        if (tx == -1 &amp;&amp; ty == -1)
        {
            if (instance_exists(target))
            {
                tx = target.x;
                ty = target.y;
            }
            else
            {
                tx = 0;
                ty = 0;
            }
        }
        else
        {
            var dist = abs(x - tx);
            if (dist &gt; 16 * 7.5)
            {
                newAngle = 3;
            }
            else if (dist &gt; 16 * 6)
            {
                newAngle = 2;
            }
            else if (dist &gt; 16 * 4)
            {
                newAngle = 1;
            }
            else
            {
                newAngle = 0;
            }
            
            if (gravDir != image_yscale)
            {
                newAngle = 3 - newAngle;
            }
            switch (newAngle)
            {
                case 0:
                    aimDist = 16 * 3.65;
                    break;
                case 1:
                    aimDist = 16 * 5;
                    break;
                case 2:
                    aimDist = 16 * 6.5;
                    break;
                case 3:
                    aimDist = 16 * 9;
                    break;
            }
            
            if ((old &amp;&amp; image_xscale == -1) || (tx &lt; x &amp;&amp; !old))
            {
                newAngle = (8 - newAngle);
            }
            phase = 1;
            
            timer = 0;
        }
    }
    else if (phase == 1) // Rotate
    {
        timer += 1;
        if (timer &gt; 10)
        {
            if (angle &lt; newAngle)
            {
                angle += 1;
            }
            else if (angle &gt; newAngle)
            {
                angle -= 1;
            }
            timer = 0;
            if (newAngle == angle)
            {
                timer = -1;
            }
            image_xscale = 1 - 2 * (angle &gt; 4);
        }
        if (timer &lt; 0)
        {
            timer -= 1;
            if (timer &lt; 30)
            {
                phase = 2;
            }
        }
    }
    else if (phase == 2) // Shoot
    {
        if (timer == 0)
        {
            playSFX(sfxCannonShoot);
            var i = instance_create(x, y, objEnemyBullet);
            i.explodeOnContact = true;
            i.contactDamage = 4;
            animOffset = 1;
            i.canHit = true;
            i.image_speed = 0;
            i.healthpoints = 1;
            i.healthpointsStart = 1;
            var animFrame = angle;
            if (animFrame &gt; 4)
                animFrame = abs(animFrame - 8);
            switch (animFrame)
            {
                case 0:
                    i.yspeed = -gravDir;
                    break;
                case 1:
                    i.yspeed = -gravDir * 2.5;
                    break;
                case 2:
                    i.yspeed = -gravDir * 3;
                    if (old)
                        i.yspeed = -gravDir * 3.75;
                    break;
                case 3:
                    i.yspeed = -gravDir * 6.5;
                    break;
            }
            i.grav = gravDir * 0.25;
            if (image_yscale != gravDir)
            {
                i.yspeed = -image_yscale * 2;
                abs(sin(degtorad(animFrame * 20)));
                i.xspeed = image_xscale * 2 * abs(cos(degtorad(animFrame * 20)));
            }
            
            if (old)
            {
                i.sprite_index = sprClassicalCannonBullet;
                i.mask_index = sprClassicalCannonBullet;
                if (col == 2)
                {
                    i.image_index = 1;
                }
            }
            else
            {
                i.sprite_index = sprNewClassicalCannonBullet;
                i.mask_index = sprNewClassicalCannonBullet;
                switch (col)
                {
                    // Blue Cannon, orange shots
                    case 1:
                        i.image_index = 2;
                        break;
                    // Red Cannon, yellow shots
                    case 3:
                        i.image_index = 1;
                        break;
                }
            }
            i.x = x + image_xscale * 16 * abs(cos(degtorad(angle * 20)));
            i.y = y - 9 * image_yscale - image_yscale * 16 * abs(sin(degtorad(angle * 20)));
            var _y = y;
            if (sign(ty - y) == gravDir)
            {
                _y = ty;
            }
            if (gravDir == image_yscale)
            {
                i.xspeed = xSpeedAim(i.x, i.y, x + aimDist * image_xscale, _y, i.yspeed, i.grav, 5);
                if (abs(i.xspeed) &lt; 3)
                    i.xspeed = 3 * image_xscale;
            }
            
            tx = -1;
            ty = -1;
        }
        if (timer &gt; 5)
            animOffset = 0;
        var waitTime = 120;
        if (old)
            waitTime = 80;
        if (timer &gt; waitTime)
        {
            phase = 0;
        }
        timer += 1;
    }
    
    var animFrame = angle;
    if (animFrame &gt; 4)
        animFrame = abs(animFrame - 8);
    image_index = animOffset * 5 + animFrame;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="25">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// spawn Event
event_inherited();
if (spawned)
{
    image_xscale = xscaleStart;
    angle = 4;
    if (old)
        angle = 3;
    newAngle = angle;
    timer = 100;
    if (old)
        timer -= 30;
    phase = 2;
    tx = -1;
    ty = -1;
    gravDir = 0;
    animOffset = 0;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
