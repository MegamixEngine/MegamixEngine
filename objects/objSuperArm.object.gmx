<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>prtPlayerProjectile</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="7" enumb="24">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>defer(ev_step, ev_step_end, 0, eventExecute, makeArray(ev_other, ev_user0, objSuperArm, true, id));

var currentWeapon = global.weapon[playerID];
var insufficientAmmo = global.ammo[playerID, currentWeapon] &lt;= 0;
var ammoCost = 2 - (1 * (global.energySaver &gt; 0));

var interactionCache = makeArray();
var interactionCacheSort = makeArray();
var interactionCacheCount = 0;

var superArmHeldObject = noone;
with (prtEntity)
{
    if (hasCategory(category, "superArmTarget"))
    {
        interactionCache[interactionCacheCount] = id;
        interactionCacheSort[interactionCacheCount] = floor(depth);
        interactionCacheCount++;
        if (superArmHoldOwner == other.id)
        {
            superArmHeldObject = id;
        }
    }
}

// prefer least-depth block
// remove this if frame rate drops (note that behaviour will change!)
quickSortBy(interactionCache, interactionCacheSort);

var doPickUpAction = false;

// not holding anything.. look for an object as a candidate!!
if (superArmHeldObject == noone)
{
    var checkPosYList = makeArray(2, 8, -2, -6, 11);
    var selectFlash = noone;
    if (!playerIsLocked(PL_LOCK_SHOOT))
    {
        for (var j = 4; j &gt;= 0; j--)
        {
            for (var i = 0; i &lt; array_length_1d(checkPosYList); i++)
            {
                for (var k = 0; k &lt; interactionCacheCount; k++)
                {
                    with (interactionCache[k])
                    {
                        var checkPosX, checkPosY;
                        with (other)
                        {
                            var checkPosX = x + image_xscale * 4 * j;
                            var checkPosY = y + checkPosYList[i] * image_yscale;
                        }
                        if (position_meeting(checkPosX, checkPosY, id) &amp;&amp; !superArmThrown &amp;&amp; superArmHoldOwner == noone &amp;&amp; !insufficientAmmo &amp;&amp; !dead)
                        {
                            selectFlash = id;
                            break;
                        }
                    }
                    
                    // continue break...
                    if (selectFlash != noone)
                    {
                        break;
                    }
                }
                
                // continue break...
                if (selectFlash != noone)
                {
                    break;
                }
            }
            
            // continue break...
            if (selectFlash != noone)
            {
                break;
            }
        }
    }
    doPickUpAction = global.keyShootPressed[playerID] &amp;&amp; !playerIsLocked(PL_LOCK_SHOOT);
    
    for (var k = 0; k &lt; interactionCacheCount; k++)
    {
        with (interactionCache[k])
        {
            if (selectFlash != id)
            {
                if (superArmFlashOwner == other.id)
                {
                    superArmFlashTimer = 0;
                    superArmFlashOwner = noone;
                }
            }
            else
            {
                if (superArmFlashOwner == noone || superArmFlashOwner == other.id)
                {
                    superArmFlashOwner = other.id;
                    superArmFlashInterval = 8;
                    superArmFlashTimer = max(superArmFlashTimer + 1, superArmFlashInterval);
                }
                
                if (doPickUpAction)
                {
                    superArmFlashTimer = -1;
                    superArmFlashOwner = other.id;
                    superArmHoldOwner = other.id;
                    superArmHeldObject = id;
                    
                    // cache previous state
                    superArmPreIsSolid = isSolid;
                    superArmPreBlockCollision = blockCollision;
                    superArmPreGrav = grav;
                    superArmPreCanHit = canHit;
                    
                    // this will overlap and look ugly, so set it to 0
                    other.weaponIconDrawing = 0;
                }
            }
        }
    }
}

// we're now holding something... move it above us, possibly throw
if (superArmHeldObject != noone)
{
    isShoot = 6;
    shootTimer = 0;
    
    assert(instance_exists(superArmHeldObject));
    assert(superArmHeldObject != id, "player somehow picked themself up with super arm.");
    
    // move above
    var originToBBoxBottom, originToBBoxTop, originToBBoxCenter;
    with (superArmHeldObject)
    {
        isSolid = false;
        blockCollision = false;
        grav = 0;
        despawnRange = -1;
        canHit = false;
        originToBBoxBottom = bbox_bottom - round(y);
        originToBBoxTop = round(y) - bbox_top;
        originToBBoxCenter = (bbox_left + bbox_right) / 2 - round(x);
    }
    
    var superArmDesiredX = x - originToBBoxCenter;
    var superArmDesiredY = y - originToBBoxBottom - 6;
    if (image_yscale == -1)
    {
        superArmDesiredY = y + originToBBoxTop + 6;
    }
    if (isSlide)
    {
        superArmDesiredY += 3*image_yscale;
    }
    
    superArmHeldObject.x = superArmDesiredX;
    superArmHeldObject.y = superArmDesiredY;
    superArmHeldObject.xspeed = 0;
    superArmHeldObject.yspeed = 0;
    
    // throw
    var doThrowAction = !doPickUpAction &amp;&amp; global.keyShootPressed[playerID] &amp;&amp; !playerIsLocked(PL_LOCK_SHOOT);
    if (doThrowAction)
    {
        global.ammo[playerID, currentWeapon] = max(global.ammo[playerID, currentWeapon] - ammoCost, 0);
        isShoot = 2;
        shootTimer = 0;
        with (superArmHeldObject)
        {
            superArmThrown = true;
            
            // adjust throw position
            y += 8 * other.image_yscale + yspeed;
            x += 16 * other.image_xscale + xspeed;
            
            // set throw velocity
            xspeed = 3.5 * other.image_xscale;
            yspeed = -2 * other.image_yscale;
            grav = 0.2;
            
            with (instance_create(x, y, objSuperArmBlockProjectile))
            {
                host = other.id;
                parent = other.superArmHoldOwner;
            }
            superArmHoldOwner = noone;
        }
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="22">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>weaponSetup("SUPER ARM", global.nesPalette[$17], global.nesPalette[$30], sprWeaponIconsSuperArm);

// objects which have the 'superArmTarget' category
// must have the following instance variables:
// superArmFlashTimer = 0;
// superArmFlashOwner = noone;
// superArmFlashInterval = 1;
// superArmHoldOwner = noone;
// superArmDeathOnDrop = true;
// superArmThrown = false;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="11">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// kill super arm block

if (superArmDeathOnDrop)
{
    dead = true;
    superArmThrown = false;
    superArmHoldOwner = noone;
    spawned = false;
    grav = superArmPreGrav;
    blockCollision = superArmPreBlockCollision;
    canHit = superArmPreCanHit;
    isSolid = superArmPreIsSolid;
    event_user(EV_SPAWN);
    if (!respawn)
    {
        instance_destroy();
    }
}
else
{
    grav = superArmPreGrav;
    blockCollision = superArmPreBlockCollision;
    canHit = superArmPreCanHit;
    isSolid = superArmPreIsSolid;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="10">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// resets super arm carry state if necessary

var owner = global.eventArgs;
with (owner)
{
    if (global.weaponObject[global.weapon[playerID]] != objSuperArm || !instance_exists(owner))
    {
        // reset
        with (prtEntity)
        {
            if (hasCategory(category, "superArmTarget"))
            {
                superArmFlashTimer = 0;
                if (superArmHoldOwner == other.id)
                {
                    superArmHoldOwner = noone;
                    if (superArmDeathOnDrop)
                    {
                        // destroyed by control flow a few lines down from here.
                        superArmThrown = true;
                    }
                    else
                    {
                        xspeed = 0;
                        yspeed = 0;
                        superArmThrown = true;
                        grav = 0.2;
                    }
                }
                
                if (superArmFlashOwner == other.id)
                {
                    superArmFlashOwner = noone;
                    superArmFlashTimer = 0;
                }
                
                // destroy thrown objects
                if (superArmThrown &amp;&amp; superArmDeathOnDrop)
                {
                    dead = true;
                    spawned = false;
                    grav = superArmPreGrav;
                    blockCollision = superArmPreBlockCollision;
                    canHit = superArmPreCanHit;
                    isSolid = superArmPreIsSolid;
                    event_user(EV_SPAWN);
                    if (!respawn)
                    {
                        instance_destroy();
                    }
                }
            }
        }
    }
    else
    {
        // terminate early other defers
        with (objDefer)
        {
            if (script == eventExecute &amp;&amp; argCount == 5)
            {
                if (args[2] == objSuperArm)
                {
                    instance_destroy();
                }
            }
        }
        defer(ev_step, ev_step_end, 0, eventExecute, makeArray(ev_other, ev_user0, objSuperArm, true, id));
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
